# 开发计划

## 将和 Cline 冲突的 Command 等 ID 修改掉【完成】

否则 ClineCN 无法注册 command、view 等组件。

## 把API供应商中的“中国”服务商提到最前面【完成】

这样方便中国用户查找。

## 添加自定义 API供应商 的能力【开发中】

开发一个新功能，让用可以自定义供应商及其下属模型。

在 Settings 界面中 API Provider 选项右侧添加一个“+”按钮，点击后弹出一个对话框，输入新增供应商名称、基础URL、API类型、API Key、Model ID 信息。
API类型目前支持"OpenAI API"格式，以后可以支持更多类型。
一个新增的供应商的一个 base url 可以有多个不同的模型，对应不同的价格信息、模型信息。

第一步：实现新增供应商的界面。包括按钮和对话框。
第二步：实现新增供应商的保存功能。保存到vscode状态存储中。
第三步：实现新增供应商的删除功能。删除后从vscode状态存储中删除、从 API供应商列表中删除。
第四步：新增的供应商应该可以自动出现在“API Provider”下拉框中并可以使用。

### 开发步骤

1. 在 OpenAiHandler 中添加读取、写入自定义供应商的方法。
2. 在 ApiOptions 中添加读取自定义供应商并显示的功能。
3. 添加持久化供应商及其对应模型的功能。

## 把 firebase 替换为中国的 serveless 服务商

例如阿里的 EMAS 移动应用工作室。

## 把请求时列出全部工作目录下的文件改为只列出一级目录下的文件

这样加快请求的响应速度。

## 发现 replace 工具经常失败，需要改进

可以改为按文件行进行替换，而不需要进行查找了。只需要告诉模型具体的行号，然后进行替换即可。
发现是因为流式响应的原因，当查找时，可能只返回了一部分数据，导致查找失败。

例如下面 AI 响应的内容就会导致替换工具失败：
```
<<<<<<< SEARCH
backgroundColor: "white",
=======
backgroundColor: "var(--vscode-editor-background)",
>>>>>>> REPLACE

borderRadius: "5px",

<<<<<<< SEARCH
color: "black
```

可以将 clinecn 使用替换工具的方式优化为等待模型输出结束，得到完整的输出后再进行替换。
如果长时间得不到模型的完整响应，再报告错误。

我们先把流式响应的等待时间加大，避免过早的报告错误。

## 将 API Request 后面的金额根据模型的区域正确设置

比如中国的模型厂商，就用人民币单位，而不是美元。

## 去掉修改文件时的动画

因为修改大文件时，如果有动画，会很慢，可以改为：在后台修改文件，完毕后打开“文件对比”编辑器即可。

## 解决上下文窗口满了的问题

当一次会话的上下文窗口满了，clinecn 该如何处理？该如何继续会话？
可能的方案：
1. 重新开启一个新的会话，将之前上下文拿过来，但不包括文件内容。
2. 重新开启一个新的会话，将之前上下文拿过来，包括倒数几次请求、响应的文件内容。
3. 重新开启一个新的会话，将之前上下文拿过来，包括倒数几次请求、响应的文件内容。其他对话过程中的文件内容做缩略处理。


## 添加“选中文本”后点击右键菜单项“解释”功能

这样就可以直接解释选中的文本。可以参考 copilot 的功能，只需要指定选择的行号给AI即可。

Copilot 的“解释”功能比较聪明，它会只截取选中的文本，或者指定文件中的类、函数等发送给AI，这样可以避免请求token过长的问题。

## 添加自动生成 git commit message 的功能

当用户点击提交代码消息框旁边按钮时，可以自动根据用户的代码变动，生成一个 git commit message。

## 创建一个社交媒体账号，类似 Cline 在 Twitter

可以用新浪微博、抖音、小红书等。然后在其中发布 MCP 服务器使用的中文教程、示例，并替换 MCP 主页面中的“示例”链接。

## 当 workspace 有多个目录时读取文件会变得混乱

无法指定同名、不同 workspace 目录下的文件，需要能区分下不同的项目根目录。

## 将 clinecn 改造为可以 debug react app 的高级开发模式

### 解决启动后扩展显示空白的问题

看 chrome dev tool 报告 main.css 找不到。

```js
Wa: Unable to read file 'e:\lab\nodejs\clinecn\webview-ui\build\static\css\main.css' (Error: Unable to resolve nonexistent file 'e:\lab\nodejs\clinecn\webview-ui\build\static\css\main.css')
```

解决办法：将对 css 的引用放到 iframe 中去，用相对路径即可访问。

# 读取文件、写入文件时要考虑具体的文件 encoding

要支持读取、写入不同的文件编码，比如 utf-8、gbk 等。可以按当前文件的编码进行读取、写入。
或者指定一个编码，然后进行读取、写入。
